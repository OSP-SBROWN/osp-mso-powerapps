Screens:
  HierMan:
    Properties:
      OnVisible: |-
        =// Initialize hierarchy management only if not already set
        If(IsBlank(AppStatus) || AppStatus = "",
            Set(AppStatus, "Ready");
            Set(AppStatusText, "Hierarchy Management - Ready to test functions")
        );
    Children:
      - cont_Screen_HierMan:
          Control: GroupContainer@1.3.0
          Variant: AutoLayout
          Properties:
            Fill: =App.Theme.Colors.Darker60
            Height: =Parent.Height
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =8
            PaddingBottom: =8
            PaddingLeft: =8
            PaddingRight: =8
            PaddingTop: =8
            Width: =Parent.Width
          Children:
            - cont_Header_HierMan:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  Fill: =App.Theme.Colors.Primary
                  FillPortions: =0
                  Height: =75
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =15
                Children:
                  - img_Menu_HierMan:
                      Control: Image@2.2.3
                      Properties:
                        Height: =Parent.Height
                        HoverFill: =App.Theme.Colors.Primary
                        Image: =Func_IconSvg("Menu",App.Theme.Colors.Darker60)
                        ImagePosition: =ImagePosition.Fill
                        OnSelect: =Set(Vis_Nav,true)
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Tooltip: ="Open Navigation Menu"
                        Width: =Self.Height
                  - lbl_Title_HierMan:
                      Control: Text@0.0.51
                      Properties:
                        FillPortions: =1
                        Height: =Parent.Height*0.7
                        Size: =Self.Height*0.7
                        Text: ="Hierarchy Management"
                        VerticalAlign: =VerticalAlign.Middle
            - cont_Main_HierMan:
                Control: GroupContainer@1.3.0
                Variant: AutoLayout
                Properties:
                  Fill: =RGBA(255, 255, 255, 1)
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                Children:
                  - btn_TestGetVersions_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="DatabaseArrowRight"
                        OnSelect: =Func_GetHierarchyVersions();
                        Text: ="1. Test Get Hierarchy Versions"
                        Width: =300
                  - btn_TestAddVersion_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="AddFriend"
                        OnSelect: |-
                          =Func_AddHierarchyVersion(
                              "Test Version " & Text(Now(), "hhmmss"),
                              "Draft",
                              Blank(),
                              User().Email
                          );
                        Text: ="2. Test Add New Version (Empty)"
                        Width: =300
                  - btn_TestDuplicateVersion_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="Copy"
                        OnSelect: |-
                          =Func_AddHierarchyVersion(
                              "Duplicate of " & First(Col_HierarchyVersions).Name & " " & Text(Now(), "hhmmss"),
                              "Draft",
                              First(Col_HierarchyVersions).ID,
                              User().Email
                          );
                        Text: ="3. Test Duplicate First Version"
                        Width: =300
                  - btn_TestUpdateVersionName_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="Edit"
                        OnSelect: |-
                          =Func_UpdateHierarchyVersion(
                              First(Col_HierarchyVersions).ID,
                              "Updated " & First(Col_HierarchyVersions).Name & " " & Text(Now(), "hhmmss"),
                              Blank()
                          );
                        Text: ="4. Test Update Name (First Version)"
                        Width: =300
                  - btn_TestUpdateVersionStatus_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="CompletedSolid"
                        OnSelect: |-
                          =Func_UpdateHierarchyVersion(
                              First(Col_HierarchyVersions).ID,
                              Blank(),
                              If(First(Col_HierarchyVersions).Status = "Draft", "Active", "Draft")
                          );
                        Text: ="5. Test Toggle Status (First Version)"
                        Width: =300
                  - btn_TestDeleteVersion_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="Delete"
                        OnSelect: |-
                          =If(
                              CountRows(Col_HierarchyVersions) > 1,
                              Func_DeleteHierarchyVersion(
                                  Last(Col_HierarchyVersions).ID
                              ),
                              Set(AppStatusText, "Cannot delete - need at least 2 versions to safely test delete")
                          );
                        Text: ="6. Test Delete (Last Version)"
                        Width: =300
                  - btn_TestGetFullHierarchy_HierMan:
                      Control: Button@0.0.45
                      Properties:
                        Height: =60
                        Icon: ="DatabaseView"
                        OnSelect: |-
                          =If(
                              !IsBlank(First(Col_HierarchyVersions)),
                              Func_GetFullHierarchy(
                                  First(Col_HierarchyVersions).ID
                              ),
                              Set(AppStatusText, "No version available - please run 'Get Versions' first")
                          );
                        Text: ="7. Test Get Full Hierarchy (First Version)"
                        Width: =300
                  - Table1:
                      Control: Table@1.0.278
                      Properties:
                        Items: =Col_HierarchyVersions
                      Children:
                        - Name1:
                            Control: TableDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="Name"
                              FieldName: ="Name"
                              FieldType: ="s"
                              Order: =1
                        - Status1:
                            Control: TableDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="Status"
                              FieldName: ="Status"
                              FieldType: ="s"
                              Order: =2
            - cmp_NavMenu_HierMan1:
                Control: CanvasComponent
                ComponentName: StatusBar
                Properties:
                  Fill: =App.Theme.Colors.Lighter30
                  Height: =cmp_NavMenu_HierMan1.Ht
                  Ht: =50
                  Wd: =App.DesignWidth-16
                  Width: =cmp_NavMenu_HierMan1.Wd
      - cmp_NavMenu_HierMan:
          Control: CanvasComponent
          ComponentName: NavMenu
          Properties:
            Height: =App.DesignHeight
            Visible: =Vis_Nav
            Width: =App.DesignWidth
